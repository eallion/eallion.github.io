document.addEventListener('DOMContentLoaded',async()=>{const m=document.querySelector('#searchBoxButton'),a=document.querySelector('#searchBoxInput'),l=document.querySelector('#searchResult'),d=document.querySelector('#searchCount');function e(){let a=location.search,b={};if(a=='')return b;a=a.substr(1);for(let c of a.split('&')){if(c=='')continue;const[d,e]=c.split('=');b[d]=decodeURI(e)}return b}var g={shouldSort:!0,includeMatches:!0,threshold:0,tokenize:!0,location:0,distance:100,maxPatternLength:32,minMatchCharLength:1,keys:[{name:"title",weight:.8},{name:"summary",weight:.5},{name:"tags",weight:.3},{name:"date",weight:.3}]};let b=null;async function h(){if(b==null){const c=await fetch('/index.json',{method:'get'}),a=await c.json();console.log(a.length),b=new Fuse(a,g)}return b}function i(a){return a.map(a=>(a=a.item,`<div class="post on-list">
                <h1 class="post-title"><a href="${a.permalink}">${a.title}</a></h1>
                <div class="post-meta"><span class="post-date">${a.date}</span> <span>#${a.tags}</span></div>
                <div class="post-content">${a.summary}</div>
              </div>`)).join('')}function j(a,b){l.innerHTML=a,d.innerHTML=`共查询到 ${b} 篇文章`}async function k(){const c=a.value,d=await h(),b=d.search(c),e=i(b);j(e,b.length)}function c(){const b=e().q||'';a.value=b,b&&k()}function f(){if(d.innerHTML=`查询中…`,a.value==e().q)return;history.pushState('','',location.pathname+'?q='+a.value),a.blur(),c()}m.addEventListener('click',f),a.addEventListener('keyup',a=>{a.key==='Enter'&&f()}),c(),window.addEventListener('popstate',c)})